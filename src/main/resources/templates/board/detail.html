<!DOCTYPE html>
<html lang="en"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultrap.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/layout}">

<body>

<div layout:fragment="content">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/Swiper/4.5.1/css/swiper.min.css">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/Swiper/4.5.1/js/swiper.min.js"></script>

  <link rel="stylesheet" th:href="@{/css/detail.css}">
  <link rel="stylesheet" th:href="@{/css/detail-swiper.css}">


  <th:block th:with="boardVO=${boardFileDTO.boardVO}">

    <hr>

    <!--중고나라 상품 디테일 기준-->
    <div class="detail-firstContainer">
      <!--왼쪽의 상품 이미지(swiper)-->
      <div class="detail-left">
        <div id="slide1" class="swiper-container">
          <div class="swiper-wrapper">
            <th:block th:each="file : ${boardFileDTO.fileVOList}">
              <div class="swiper-slide">
                <a href="/event/roulette">
                  <!-- 동적으로 이미지 출력 -->
                  <img th:src="@{${file.fileUrl}}" alt="상품 이미지">
                </a>
              </div>
            </th:block>
          </div>

          <!-- 네비게이션 -->
          <div class="swiper-button-next"><img src="/img/next.svg" class="slide-button"></div><!-- 다음 버튼 (오른쪽에 있는 버튼) -->
          <div class="swiper-button-prev"><img src="/img/prev.svg" class="slide-button"></div><!-- 이전 버튼 -->

          <!-- 페이징 -->
          <div class="swiper-pagination"></div>
        </div>
      </div>

      <!--오른쪽의 상품 정보-->
      <div class="detail-right">
        <!--카테고리-->
        <div class="detail-category">[[${boardVO.category}]]</div>

        <div class="detail-titleBox">
          <!--판매글 제목-->
          <span class="detail-title">[[${boardVO.boardName}]]</span>

          <!--url 복사 아이콘-->
          <span class="detail-url"><img src="/img/banner-url.svg" onclick="clip()"></span>
        </div>

        <!--상품 가격-->
        <div class="detail-price">[[${boardVO.formattedPrice}]]원</div>

        <div class="detail-atcBox">
          <div class="detail-atc">
            <!--등록 시간-->
            <span>[[${timeAgo}]]</span>

            <!--구분점-->
            <span class="detail-divider">·</span>

            <!--조회수-->
            <span>조회 <span th:text="${boardVO.readCount}">0</span></span>

            <!--구분점-->
            <span class="detail-divider">·</span>

            <!--찜 수-->
            <span>찜 <span id="likeCount">[[${boardVO.likeCount}]]</span></span>
          </div>

          <!--시세 조회 href-->
          <a href="/board/price"><span class="detail-boardPrice">시세조회</span></a>
        </div>

        <div class="detail-addressBox">
          <span class="detail-divider">·</span>

          <span>거래희망지역</span>

          <!--지역 동 출력-->
          <span class="detail-addressName">[[${sellerAddress}]]</span>
        </div>

        <!--찜하기, 채팅하기, 구매하기-->
        <div class="detail-buttons">
          <button type="button" id="wishBtn" class="detail-likeCountButton" th:data-board-id="${boardVO.boardId}">
            <span id="wishIcon">
                <!-- 조건에 맞는 아이콘 표시 -->
                <svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" fill="currentColor" class="bi"
                     th:classappend="${isAlreadyWished != null && isAlreadyWished ? 'bi-heart-fill' : 'bi-heart'}" viewBox="0 0 16 16">
                    <path th:if="${isAlreadyWished != null && isAlreadyWished}" fill-rule="evenodd" d="M8 1.314C12.438-3.248 23.534 4.735 8 15-7.534 4.736 3.562-3.248 8 1.314"/>
                    <path th:if="${isAlreadyWished != null && !isAlreadyWished}" d="m8 2.748-.717-.737C5.6.281 2.514.878 1.4 3.053c-.523 1.023-.641 2.5.314 4.385.92 1.815 2.834 3.989 6.286 6.357 3.452-2.368 5.365-4.542 6.286-6.357.955-1.886.838-3.362.314-4.385C13.486.878 10.4.28 8.717 2.01zM8 15C-7.333 4.868 3.279-3.04 7.824 1.143q.09.083.176.171a3 3 0 0 1 .176-.17C12.72-3.042 23.333 4.867 8 15"/>
                </svg>
            </span>
          </button>

          <button class="detail-chattingButton">채팅하기</button>

          <button class="detail-buyingButton btn-custom" id="paymentBtn">구매하기</button>

          <button href="#" data-bs-toggle="modal" data-bs-target="#reportModal" class="detail-atcButton-1">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="currentColor" class="bi bi-shield-exclamation" viewBox="0 0 20 20">
              <path d="M5.338 1.59a61 61 0 0 0-2.837.856.48.48 0 0 0-.328.39c-.554 4.157.726 7.19 2.253 9.188a10.7 10.7 0 0 0 2.287 2.233c.346.244.652.42.893.533q.18.085.293.118a1 1 0 0 0 .101.025 1 1 0 0 0 .1-.025q.114-.034.294-.118c.24-.113.547-.29.893-.533a10.7 10.7 0 0 0 2.287-2.233c1.527-1.997 2.807-5.031 2.253-9.188a.48.48 0 0 0-.328-.39c-.651-.213-1.75-.56-2.837-.855C9.552 1.29 8.531 1.067 8 1.067c-.53 0-1.552.223-2.662.524zM5.072.56C6.157.265 7.31 0 8 0s1.843.265 2.928.56c1.11.3 2.229.655 2.887.87a1.54 1.54 0 0 1 1.044 1.262c.596 4.477-.787 7.795-2.465 9.99a11.8 11.8 0 0 1-2.517 2.453 7 7 0 0 1-1.048.625c-.28.132-.581.24-.829.24s-.548-.108-.829-.24a7 7 0 0 1-1.048-.625 11.8 11.8 0 0 1-2.517-2.453C1.928 10.487.545 7.169 1.141 2.692A1.54 1.54 0 0 1 2.185 1.43 63 63 0 0 1 5.072.56"/>
              <path d="M7.001 11a1 1 0 1 1 2 0 1 1 0 0 1-2 0M7.1 4.995a.905.905 0 1 1 1.8 0l-.35 3.507a.553.553 0 0 1-1.1 0z"/>
            </svg>
            신고
          </button>
        </div>

      </div>

    </div>

    <!--왼쪽 상품 정보, 오른쪽 가게 정보-->
    <div class="detail-secondContainer">
      <!--판매글 content 가져와서 출력-->
      <div class="detail-left">
        <div class="detail-title">상품 정보</div>

        <!--판매글 content-->
        <div  id="boardContent" th:utext="${boardVO.boardContent}"></div>
      </div>

      <!--myInfo 가져와서 출력-->
      <div class="detail-right">
        <div class="detail-title">가게 정보</div>

        <div class="detail-user">
          <!--판매자 유저 이름-->
          <div class="detail-name">판매자 유저이름</div>
          <div class="detail-profile"><img src="/img/profile.png"></div>
        </div>

        <!--매너 지수-->
        <div>
          <span>매너지수</span>
        </div>

        <div th:if="${#authentication.principal != 'anonymousUser' && #authentication.principal.userVO.userNum == boardVO.sellerId}">
          <button type="button" class="btn-custom" id="modBtn">수정</button>
          <a th:href="@{/board/delete(boardId=${boardVO.boardId})}"><button class="btn-custom" type="button" id="delBtn">글삭제</button></a>
        </div>

      </div>
    </div>

    <!--같은 카테고리인 상품들을 출력-->
    <div class="detail-thirdContainer">
      <div class="detail-title">이런 상품은 어때요?</div>

      <!--swiper-->
      <div>
        <div id="slide6" class="swiper-container">
          <div class="swiper-wrapper">
            <!-- ${sameCategoryProducts} 리스트를 반복 -->
            <div class="swiper-slide" th:each="product : ${sameCategoryProducts}">
              <a th:href="@{/board/detail(boardId=${product.boardVO.boardId})}">
                <!-- 이미지가 있는 경우에만 출력 -->
                <img th:if="${not #lists.isEmpty(product.fileVOList)}" th:src="${product.fileVOList[0].fileUrl}" alt="상품 이미지">
                <div class="item-title" th:text="${product.boardVO.boardName}"></div>
                <div class="item-price" th:text="${product.boardVO.formattedPrice} + '원'"></div>
                <div class="item-atc" th:text="${SameCategoryProductTime[product.boardVO.boardId]} + ' | ' + ${getSellerAddr[product.boardVO.sellerId]}"></div>
              </a>
            </div>
          </div>

          <div class="swiper-button-next"><img src="/img/next.svg" class="slide-button"></div>
          <div class="swiper-button-prev"><img src="/img/prev.svg" class="slide-button"></div>

          <div class="swiper-pagination"></div>
        </div>
      </div>
    </div>

    <hr>


    <form id="reportForm" action="/board/report" method="post">
      <div class="modal fade" id="reportModal" tabindex="-1" aria-labelledby="reportModalLabel" aria-hidden="true">
        <div class="modal-dialog">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="reportModalLabel">신고 사유 선택</h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
              <div class="mb-3">
                <label for="reasonSelect" class="form-label">신고 사유</label>
                <select id="reasonSelect" class="form-select" name="reasonId" required>
                  <option value="">신고 사유를 선택하세요</option>
                  <option th:each="reason : ${reasonList}"
                          th:value="${reason.compId}"
                          th:text="${reason.compContent}">
                  </option>
                </select>
              </div>
              <!-- sellerId (신고 당할 사람), 게시글 번호(리다이렉트용) -->
              <input type="hidden" name="sellerId" th:value="${boardVO.sellerId}">
              <input type="hidden" name="boardId" th:value="${boardVO.boardId}">
              <input type="hidden" name="reporterId"
                     th:value="${#authentication.principal != 'anonymousUser' ? #authentication.getPrincipal().userVO.userNum : ''}">
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">취소</button>
              <button type="submit" class="btn btn-danger" id="submitReport">신고하기</button>
            </div>
          </div>
        </div>
      </div>
    </form>

    <div id="custom-alert" class="event-modal">
      <div class="event-modalContent">
        <p id="alert-message"></p>
        <hr class="event-divider">
        <button id="alert-ok-button">확인</button>
      </div>
    </div>

    <script th:inline="javascript">
      /*<![CDATA[*/
      var boardFileDTO = [[${boardFileDTO}]];
      /*]]>*/
    </script>

    <script th:inline="javascript">
      /*<![CDATA[*/
      var boardId = [[${boardVO.boardId}]];
      /*]]>*/
          /*<![CDATA[*/
      var tradeFlag = [[${boardVO.tradeFlag}]];
      /*]]>*/
    </script>

    <script th:inline="javascript">
      /*<![CDATA[*/

       var principal = [[${#authentication.principal}]];

       document.getElementById('paymentBtn').addEventListener('click', function() {
         var principal = [[${#authentication.principal}]];
         if (principal === 'anonymousUser') {
           window.location.href = '/user/login';
         }
       });

       document.getElementById('reportBtn').addEventListener('click', function() {
         var principal = [[${#authentication.principal}]];
         if (principal === 'anonymousUser') {
           window.location.href = '/user/login';
         }
       });
       /*]]>*/
    </script>

    <script src="https://cdn.iamport.kr/v1/iamport.js"></script>
    <script th:src="@{/js/buy.js}"></script>
    <script th:src="@{/js/productBoardDetail.js}"></script>
    <script th:src="@{/js/event-modal.js}"></script>
    <script th:src="@{/js/url.js}"></script>
    <script th:src="@{/js/detail-swiper.js}"></script>

  </th:block>



</div>


</body>